近期肆虐的WannaCry勒索病毒对文件的加密过程如图:
![](http://image.3001.net/images/20170514/14946956502669.png)
看完这篇文章你将了解到这个病毒到底是怎样对我们的文件进行加密的
#密码学中的加密算法
- [对称加密算法](#对称加密算法)
- [非对称加密算法](#非对称加密算法)
- [散列算法](#散列算法)
- [WannaCry勒索病毒文件加密分析](#WannaCry勒索病毒文件加密分析)
- [各种加密算法对比](#各种加密算法对比)

##前言
###什么是加密算法?  
加密算法是指原来为明文的文件或数据按某种算法进行处理，使其成为不可读的一段代码，通常称为“密文”，使其只能在输入相应的解密密钥之后才能显示出本来内容.关系图如下:  
```明文--(加密密钥)-->密文  ```  
``` 密文--(解密密钥)-->明文```  
###加密算法有什么用?  
总体来说有三大作用:  
1.将数据加密,只有持有解密密钥的人才能看到原本的内容,用于保护数据   
2.身份认证(非对称加密算法)   
3.数字签名(散列算法)    
关于后面两个作用将会在下面的文章给出具体解释

##对称加密算法
###什么是对称加密算法? 
对称加密算法是指加密密钥和解密密钥相同的加密算法,最流行的对称加密算法是:`DES` `3DES` `AES`  
DES算法密钥为64位,并且将明文数据划分为64位的分组,然后与密钥进行16轮的异或置换以及其他操作,最终生成密文,DES解密则使用相同的密钥,从后向前进行16轮变换,最终得到明文数据  
3DES是建立在DES算法基础上,它采用了3次DES加密算法,最终生成密文  
AES加密算法与DES类似,不过密钥长度更长:128、192、256位,因此安全性更高,因此使用对称加密算法的时候推荐使用AES  
###应用场景有哪些?
对称加密算法的优点在于加解密的高速度和使用长密钥时的难破解性。因此当我们想对一些txt文档,word文档等文件进行加解密操作时,可以优先考虑使用对称加密算法.值得一提的是,近期爆发的wannacry勒索病毒就是使用AES算法对我们的文件进行了加密.
###效率,安全性如何?
![](http://olilzmmvk.bkt.clouddn.com/aes.png)

##非对称加密算法
###什么是非对称加密算法? 
非对称加密算法是指加密密钥和解密密钥不相同的加密算法,使用的时候会生成一对公私钥,使用公钥加密后只有使用配对的私钥才能解密,最流行的非对称解密算法是:`RSA`  
RSA算法基于一个十分简单的数论事实：将两个大质数相乘十分容易，但是想要对其乘积进行因式分解却极其困难，因此可以将乘积公开作为加密密钥。[详细原理请点我](http://www.cnblogs.com/AloneSword/p/3326750.html)  
###应用场景有哪些?
在这里我将非对称加密算法的作用分为两类:  
1.数据加密  
非对称加密算法中有公钥和私钥两个概念,公钥是可以公开给他人的密钥,而私钥是自己持有,必须保密的密钥.现在A和B进行通信,A要向B安全发送文件,那么A就是加密者,B是解密者,B生成一对公私钥,将公钥给了A,私钥自己保留,那么A拿到公钥后将文件进行加密后传给B,B收到文件后就可以用自己的私钥进行解密.  
``` A --(公钥加密)-->加密后的文件```
``` B --(私钥解密)-->解密后的文件```  
2.身份认证  
身份认证的意思是在网络环境中确认操作者的身份.现在A和B进行通信,互联网通信使得B不知道正在跟自己交谈的人是否是A,因此需要确认A的身份,那么此时A就可以通过RSA算法生成一对公私钥,公钥是公开的,可以给任何人,私钥自己保留,因此今后在A的每次通信时,A都会将自己的一些身份信息通过私钥进行加密,对方可以通过公钥进行解密,进而识别身份信息.   
```A --(私钥加密)-->加密后的身份信息```  
```其他人 ---(公钥解密)-->解密后的身份信息 ```  
###效率,安全性如何?
相较于对称加密算法,非对称加密算法安全性更高,但是加解密效率低,因此不适用于对文件的加解密,而适用于对密码等信息量较少的字节进行加解密.
![](http://olilzmmvk.bkt.clouddn.com/rsa.png)

##散列算法
###什么是散列算法? 
它对不同长度的输入消息，产生固定长度的输出.MD5:128bit SHA-1:160bit 其他还有SHA-224、SHA-256、SHA-384和SHA-512.  
散列算法的最大特点是雪崩效应和不可逆特性.雪崩效应:任意长度的消息只要被篡改1bit就会导致散列值的输出不同,不可逆是无法通过散列值计算出消息明文.

###应用场景有哪些?
很多,例如一些网站的下载资源最后会跟上md5值,用户下载文件之后可以通过求文件的md5值与网站的md5进行对比判断,判断自己是否下载了正确的资源,还有就是很多网站的注册功能都会将密码以md5的形式存储,这样就可以提高账户的安全性.

###效率,安全性如何?
首先推荐一个[网站](http://www.cmd5.com/),该网站可以进行md5加密和解密,对,你没听错,可以进行解密,不过我们可以看一下解密规则:
![](http://olilzmmvk.bkt.clouddn.com/md5.png)
我们可以做如下实验:
密码:admin
![](http://olilzmmvk.bkt.clouddn.com/md5_1.png)
![](http://olilzmmvk.bkt.clouddn.com/md5_2.png)
密码:188********
![](http://olilzmmvk.bkt.clouddn.com/md5_3.png)
![](http://olilzmmvk.bkt.clouddn.com/md5_4.png)
原理很简单,穷举,将密码的排列组合穷举出来,并求出每个密码对应的md5值,形成类似Map集合的键值对形式,构造一张表,这张表叫做`彩虹表`,然后根据md5值进行搜索,看表里面是否有对应的明文密码.   
那怎样将我们的密码安全性再提升一个层次呢?请大家注意上图中的网站在对密码进行md5加密时提供了一个可选项:Salt,这是啥?这个叫做盐值,在我们对密码进行md5加密前,可以将salt附加在密码后面,这样求出的md5被攻破的可能性将大大降低.关于md5加盐的知识大家可以自行百度.
###王小云教授,中国人的骄傲
2005年,山东大学王小云教授成功破解SHA-1和md5算法,震惊国际密码大会,她采用hash碰撞算法可以在很短时间内破解md5,通过散列值求出明文.
##WannaCry勒索病毒文件加密分析
![](http://image.3001.net/images/20170514/14946956502669.png)
如图:黑客最终对文件加密采用的是对称密码算法:AES,不过这个AES的密钥是随机生成的,并且又被RSA公钥加密了,所以说想要解密文件,必须弄到黑客手中的RSA私钥,将AES的密钥解密,解密之后的密钥再对文件进行解密才能还原文件,想了解WannaCry更多我推荐[这篇文章](http://www.freebuf.com/articles/system/134578.html)
##各种加密算法对比
![](http://olilzmmvk.bkt.clouddn.com/encode.png)
